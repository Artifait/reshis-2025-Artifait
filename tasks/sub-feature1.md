# Привязка Telegram

## Контекст

Для доступа к Telegram-2FA пользователь должен привязать Telegram-аккаунт. При том необходимо добиться минимум требуемых действия от пользователя, удобности в использование и защиты от возможности указать не коректный аккаунт, что может привести к потери доступа к дневнику у пользователя, тк бот будет отправлять запрос на подтверждение входа на не корректный аккаунт.

## Алгоритм привязки

1. Пользователь нажимает /start в боте.
2. Через Webhook получаем команду и перенаправляем в telegram_service
3. Сервис создаёт token, и связывает token с Id данного чата.
4. После чего token отправляется пользователю
5. Пользователь копирует его и вставляет на сайте.
6. После чего отправляется POST запрос на обработчик по пути /auth/profile/telegram/verify, который уже может сопоставить, что данному пользователю принаджетит чат с ID таким-то.

## UI модального окна

- QR-код + кнопка для быстрого перехода в бота.
- Одно поле ввода токена.
- Одна кнопка «Подтвердить», одна «Отмена».
- Поле очищается после подтверждения.
- Фронтовая валидация: `^[A-Za-z0-9_-]{8,128}$`.
- Flash «Telegram успешно привязан как @USERNAME».

## Webhook & Endpoints

- `POST /webhook/telegram` — обрабатывает `/start` и создаёт/отправляет токен.
- `POST /auth/profile/telegram/verify` — привязать токен к текущему пользователю.
- `POST /auth/profile/telegram/unbind` — открепить и удалить токены пользователя.

## **Use case**

1. User переходит в telegram бота, нажимает /start, получает уникальный токен
2. В модальном окне вводит его
3. Аккаунт привязан
